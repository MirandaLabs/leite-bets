version: '3.8'

services:
  # O Scraper roda localmente na sua máquina
  scraper-local:
    build: 
      context: .
      dockerfile: scrapers/dockerfile
    container_name: leite-bets-local-scraper
    restart: unless-stopped
    ports:
      - "8000:8000"
    env_file:
      - .env.local
    environment:
      - PORT=8000
    volumes:
      # Mapeia as pastas locais para dentro do container
      # Isso permite que você edite o código e veja a mudança sem rebuildar (ótimo para dev)
      - ./scrapers:/app/scrapers
      - ./storage:/app/storage

  # O n8n roda localmente para orquestrar
  n8n-local:
    image: n8nio/n8n:latest
    container_name: leite-bets-local-n8n
    restart: unless-stopped
    ports:
      - "5679:5678" # Roda na porta 5679 para não conflitar com nada
    env_file:
      - .env.local
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5679
      - GENERIC_TIMEZONE=America/Sao_Paulo
      # Permite chamar o scraper-local
      - N8N_ENV_WHITELIST=REMOTE_API_URL,DATABASE_URL
    volumes:
      - n8n_local_data:/home/node/.n8n

volumes:
  n8n_local_data: