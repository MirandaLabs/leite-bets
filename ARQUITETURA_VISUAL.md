# ğŸ“Š Arquitetura Visual - LeiteBets no Railway

---

## ğŸ—ï¸ ARQUITETURA GERAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RAILWAY PLATFORM                       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PostgreSQL    â”‚  â”‚   Backend    â”‚  â”‚   Scraper      â”‚  â”‚
â”‚  â”‚   Port 5432     â”‚  â”‚   Port 8000  â”‚  â”‚   Port 8000    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚              â”‚  â”‚                â”‚  â”‚
â”‚  â”‚ â€¢ Events        â”‚  â”‚ â€¢ FastAPI    â”‚  â”‚ â€¢ Playwright   â”‚  â”‚
â”‚  â”‚ â€¢ Odds          â”‚  â”‚ â€¢ Triggers   â”‚  â”‚ â€¢ Collectors   â”‚  â”‚
â”‚  â”‚ â€¢ Arbitrages    â”‚  â”‚ â€¢ API Routes â”‚  â”‚ â€¢ Parsers      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                  â”‚                   â”‚           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                              â”‚                               â”‚
â”‚              HTTP/HTTPS Calls â”‚                              â”‚
â”‚                              â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚      N8N      â”‚           â”‚   Telegram    â”‚
         â”‚  (Scheduler)  â”‚           â”‚      Bot      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             Schedule Trigger              Notifications
             (a cada 30 min)              (arbitragens)
```

---

## ğŸ”„ FLUXO DE EXECUÃ‡ÃƒO - TRIGGER TODOS

```
                          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                          â•‘  InÃ­cio: N8N Schedule Trigger     â•‘
                          â•‘  (a cada 30 minutos)              â•‘
                          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚
                          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                          â•‘  HTTP POST /api/trigger/all       â•‘
                          â•‘  (para: Backend Railway)          â•‘
                          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚
                          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                          â•‘  Backend recebe request           â•‘
                          â•‘  â””â”€ Retorna "triggered" (~200ms)  â•‘
                          â•‘  â””â”€ Inicia background task        â•‘
                          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Background Task Inicia   â”‚
                          â”‚   (nÃ£o bloqueia API)       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                                     â”‚              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                       â”‚   â”‚                  â”‚
             â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”
             â”‚  Betano   â”‚          â”‚Bet365  â”‚â”‚Supeâ”‚ â”‚Espoâ”‚ â”‚ WAIT â”‚
             â”‚  20-40s   â”‚          â”‚15-30s  â”‚â”‚rbetâ”‚ â”‚rtesâ”‚ â”‚ 120s â”‚
             â”‚           â”‚          â”‚        â”‚â”‚30s â”‚ â”‚40s â”‚ â”‚     â”‚
             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”¬â”˜ â”‚     â”‚
                   â”‚                    â”‚       â”‚        â”‚  â”‚     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
    â”‚                                                       â”‚
    â”‚ Cada scraper coletando:                          Backend
    â”‚ â€¢ Navega no site com Playwright                  aguarda
    â”‚ â€¢ Localiza eventos e odds                        conclusÃ£o
    â”‚ â€¢ Extrai HTML/parseia dados
    â”‚ â€¢ Retorna JSON com dados
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
                   â”‚              â”‚              â”‚      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”
         â”‚   25 items â”‚  â”‚  18 items  â”‚ â”‚31 itemsâ”‚ â”‚22 it â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜
               â”‚              â”‚             â”‚        â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                   â•”â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                   â•‘  Backend processa dados  â•‘
                   â•‘  â€¢ Salva eventos        â•‘
                   â•‘  â€¢ Salva odds           â•‘
                   â•‘  â€¢ Calcula arbitragens  â•‘
                   â•‘  â€¢ Querypa banco        â•‘
                   â•šâ•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Dados Salvos      â”‚
                   â”‚   no PostgreSQL     â”‚
                   â”‚                     â”‚
                   â”‚ +25 eventos         â”‚
                   â”‚ +96 odds            â”‚
                   â”‚ Total: 150 eventos  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                   â•”â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                   â•‘  Bot do Telegram       â•‘
                   â•‘  Envia notificaÃ§Ã£o     â•‘
                   â•‘  "96 novos dados de    â•‘
                   â•‘   4 casas encontrados" â•‘
                   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“¡ OPÃ‡Ã•ES DE TRIGGER

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMO INICIAR A RASPAGEM?                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OPÃ‡ÃƒO 1: N8N (RECOMENDADO - ProduÃ§Ã£o)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     N8N Schedule Trigger
           â”‚
           â–¼
     HTTP POST /api/trigger/all
           â”‚
           â”œâ”€ Resposta imediata (~500ms)
           â”‚
           â””â”€ Scrapers rodam em background (60-120s)
                   â”‚
                   â””â”€ Telegram notifica quando pronto

âœ… Vantagens: Robusto, sem timeout, escalÃ¡vel, monitora automaticamente
âŒ Desvantagens: Mais componentes


OPÃ‡ÃƒO 2: N8N Direto para Scraper
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     N8N Schedule Trigger
           â”‚
           â–¼
     HTTP POST /scrape/betano
           â”‚
           â”œâ”€ Aguarda 20-40s
           â”‚
           â””â”€ HTTP POST /scrape/bet365
                   â”‚
                   â”œâ”€ Aguarda 15-30s
                   â”‚
                   â””â”€ HTTP POST /api/odds/update
                           â”‚
                           â””â”€ Salva no banco

âœ… Vantagens: Simples, direto
âŒ Desvantagens: Timeout apÃ³s 30s, mais complexo, sem background


OPÃ‡ÃƒO 3: Manual (DEBUG/TESTES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     curl -X POST /api/trigger/all
           â”‚
           â””â”€ Teste rÃ¡pido da API
                   â”‚
                   â””â”€ Ãštil para validaÃ§Ã£o e desenvolvimento

âœ… Vantagens: RÃ¡pido para testes
âŒ Desvantagens: Manual, sem automaÃ§Ã£o


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RECOMENDAÃ‡ÃƒO: Use OPÃ‡ÃƒO 1 (N8N â†’ Backend â†’ Scraper)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”— FLUXO DE DADOS - Detalhado

```
PASSO 1: TRIGGER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  N8N                Backend              Scraper
   â”‚                  â”‚                     â”‚
   â”œâ”€ POST /api/trigger/all â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                  â”‚                     â”‚
   â”‚â—€â”€ {"status": "triggered"} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                  â”‚                     â”‚


PASSO 2: BACKGROUND TASK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   Backend                                 Scraper
   â”‚                                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
   â”‚                                          â”‚
   â”‚ â”Œâ”€ POST /scrape/betano                  â”‚
   â”‚ â”‚  (aguarda 20-40s)                     â”‚
   â”‚ â”‚                                       â”‚
   â”‚ â””â—€â”€ {"source": "betano", "items": 25}  â”‚
   â”‚    [event_1, event_2, ..., event_25]   â”‚
   â”‚                                         â”‚
   â”‚ â”Œâ”€ POST /scrape/bet365                  â”‚
   â”‚ â”‚  (aguarda 15-30s)                     â”‚
   â”‚ â”‚                                       â”‚
   â”‚ â””â—€â”€ {"source": "bet365", "items": 18}  â”‚
   â”‚    [event_26, event_27, ..., event_43] â”‚
   â”‚                                         â”‚
   â”‚ ... (outros scrapers)                   â”‚
   â”‚                                         â”‚
   â”œâ”€ 96 eventos coletados de 4 casas        â”‚


PASSO 3: SALVAR NO BANCO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   Backend           PostgreSQL
    â”‚                    â”‚
    â”œâ”€ INSERT events â”€â”€â”€â–¶â”‚
    â”‚ [96 novos]         â”‚
    â”‚                    â”‚
    â”œâ”€ INSERT odds â”€â”€â”€â”€â”€â–¶â”‚
    â”‚ [96 novos]         â”‚
    â”‚                    â”‚
    â”œâ”€ UPDATE status â”€â”€â”€â–¶â”‚
    â”‚ [arbitragens]      â”‚
    â”‚                    â”‚
    â”œâ—€â”€ COMMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                    â”‚


PASSO 4: NOTIFICAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   Backend           Telegram Bot
    â”‚                    â”‚
    â”œâ”€ POST /sendMessage
    â”‚ "âœ… Raspagem completa!
    â”‚  96 novos eventos coletados
    â”‚  Betano: 25
    â”‚  Bet365: 18
    â”‚  Superbet: 31
    â”‚  EsportesDaSorte: 22"
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Chat do Telegram
```

---

## ğŸ—„ï¸ ESTRUTURA DO BANCO DE DADOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PostgreSQL Database                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚      events          â”‚      â”‚       odds           â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ id (PK)              â”‚â—€â”€â”€â”€â”€â”€â”‚ id (PK)              â”‚       â”‚
â”‚  â”‚ sport                â”‚      â”‚ event_id (FK)        â”‚       â”‚
â”‚  â”‚ league               â”‚      â”‚ bookmaker            â”‚       â”‚
â”‚  â”‚ home_team            â”‚      â”‚ home_odd             â”‚       â”‚
â”‚  â”‚ away_team            â”‚      â”‚ draw_odd             â”‚       â”‚
â”‚  â”‚ event_date           â”‚      â”‚ away_odd             â”‚       â”‚
â”‚  â”‚ status (upcoming)    â”‚      â”‚ home_or_draw_odd     â”‚       â”‚
â”‚  â”‚ created_at           â”‚      â”‚ away_or_draw_odd     â”‚       â”‚
â”‚  â”‚ finished_at          â”‚      â”‚ is_active            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ scraped_at           â”‚       â”‚
â”‚                                â”‚ created_at           â”‚       â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      arbitrages (calculado do zero)              â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ id (PK)                                          â”‚         â”‚
â”‚  â”‚ event_id (FK)                                    â”‚         â”‚
â”‚  â”‚ bookmaker_a                                      â”‚         â”‚
â”‚  â”‚ bookmaker_b                                      â”‚         â”‚
â”‚  â”‚ roi (%)                                          â”‚         â”‚
â”‚  â”‚ status (aberta, finalizada, travada)            â”‚         â”‚
â”‚  â”‚ created_at                                       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ãndices para performance:
- idx_events_status (filtra por upcoming/live/finished)
- idx_events_event_date (filtra por data)
- idx_odds_is_active (filtra odds ativas)
- idx_odds_event_bookmaker (busca rÃ¡pida por evento + casa)
```

---

## â±ï¸ TIMELINE COMPLETA

```
T+0s    : N8N faz POST /api/trigger/all
          â””â”€ Backend recebe e inicia background task

T+1-2s  : Backend retorna "triggered" para N8N
          â””â”€ N8N recebe resposta com sucesso

T+3s    : Backend comeÃ§a a chamar scrapers
          â”œâ”€ POST /scrape/betano
          â”œâ”€ POST /scrape/bet365
          â”œâ”€ POST /scrape/superbet
          â””â”€ POST /scrape/esportesdasorte

T+20-40s : Scraper 1 retorna (Betano: 25 items)
T+40-45s : Scraper 2 retorna (Bet365: 18 items)
T+60-65s : Scraper 3 retorna (Superbet: 31 items)
T+80-90s : Scraper 4 retorna (EsportesDaSorte: 22 items)

T+95s   : Backend salva tudo no PostgreSQL
          â”œâ”€ INSERT 96 events
          â”œâ”€ INSERT 96 odds
          â””â”€ UPDATE arbitrages

T+96s   : Bot do Telegram envia notificaÃ§Ã£o
          â””â”€ "âœ… Raspagem completa! 96 novos dados"

T+120s  : N8N pode fazer await do status
          â”œâ”€ GET /api/scraper/status
          â””â”€ Recebe confirmaÃ§Ã£o de dados salvos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TOTAL: 120 segundos por ciclo de raspagem
CICLOS: A cada 30 minutos (configurÃ¡vel no N8N)
```

---

## ğŸ“ REQUISIÃ‡Ã•ES HTTP - Resumidas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REQUEST/RESPONSE FLOW                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

1. N8N â†’ Backend

   POST https://seu-backend-railway.railway.app/api/trigger/all
   
   Headers:
   â”œâ”€ Content-Type: application/json
   â””â”€ Authorization: (opcional)
   
   Body: {} (vazio)
   
   Response (200 OK):
   {
     "status": "triggered",
     "message": "Scrapers iniciados em background",
     "timestamp": "2026-01-28T15:30:45.123456"
   }


2. Backend â†’ Scraper (4x, paralelo ou sequencial)

   POST https://seu-scraper-railway.railway.app/scrape/betano
   
   Response (200 OK):
   {
     "source": "betano",
     "items": 25,
     "data": [
       {
         "id": "evt_123",
         "name": "Time A vs Time B",
         "start_time": "2026-01-28T20:00:00Z",
         "sport": "futebol",
         "league": "brasileirao",
         "home_team": "Time A",
         "away_team": "Time B",
         "odds": [
           {
             "bookmaker": "betano",
             "home": 2.10,
             "draw": 3.20,
             "away": 3.50
           }
         ]
       },
       ... (24 mais)
     ]
   }


3. Backend â†’ PostgreSQL

   INSERT INTO events (id, sport, league, ...) VALUES (...)
   INSERT INTO odds (id, event_id, bookmaker, ...) VALUES (...)
   INSERT INTO arbitrages (event_id, bookmaker_a, ...) VALUES (...)


4. Backend â†’ Telegram Bot

   POST https://api.telegram.org/bot{TOKEN}/sendMessage
   
   Body:
   {
     "chat_id": "CHAT_ID",
     "text": "âœ… Raspagem completada!
              96 novos eventos coletados
              ..."
   }


5. (Opcional) N8N â†’ Backend (verificar status)

   GET https://seu-backend-railway.railway.app/api/scraper/status
   
   Response (200 OK):
   {
     "status": "ok",
     "database": {
       "events": 150,
       "odds": 450,
       "upcoming_events": 120,
       "live_events": 5,
       "finished_events": 25
     },
     "last_scrape": "2026-01-28T15:32:36Z"
   }

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” SEGURANÃ‡A - Fluxo de AutenticaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPONENTES DE SEGURANÃ‡A                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

1. DATABASE
   â”œâ”€ Credenciais: DATABASE_URL com password
   â”œâ”€ ConexÃ£o: SSL/TLS (Railway fornece)
   â””â”€ Acesso: Apenas via Backend

2. TELEGRAM BOT
   â”œâ”€ Token: TELEGRAM_BOT_TOKEN (seguro em Railway Secrets)
   â”œâ”€ Chat ID: TELEGRAM_CHAT_ID (seguro em Railway Secrets)
   â””â”€ Acesso: Apenas Backend pode enviar mensagens

3. SCRAPER API
   â”œâ”€ Sem autenticaÃ§Ã£o (internal, mesma rede)
   â”œâ”€ Network: Railway internal (nÃ£o pÃºblico se possÃ­vel)
   â””â”€ Rate limit: Implementado via scheduler N8N

4. N8N
   â”œâ”€ HTTP Request: POST sem auth necessÃ¡ria (Railway internal)
   â”œâ”€ Schedule: Cron job interno
   â””â”€ Logging: MantÃ©m histÃ³rico de execuÃ§Ãµes

5. PROXIES (se usando)
   â”œâ”€ IPs: Configurados como Secrets no Railway
   â”œâ”€ RotaÃ§Ã£o: AleatÃ³ria a cada execuÃ§Ã£o
   â””â”€ Descarte: Usado para evitar banimento de IP
```

---

## âœ¨ RESUMO VISUAL

```
  â”Œâ”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”
  â”‚ N8N â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Backend â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Scraper  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ DB â”‚
  â””â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”˜
   Trigger        Trigger              Coleta dados        Armazena
   30min          Background           Betano
                  Task                 Bet365
                                       Superbet
                                       EsportesDaSorte


  â”Œâ”€â”€â”€â”€â”
  â”‚ DB â”‚
  â””â”€â”¬â”€â”€â”˜
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Backend  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Telegramâ”‚
                        â”‚ Arbitrageâ”‚        â”‚ Bot     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        Calcula            Notifica
                        ROI
```

---

**Todos os diagramas baseados na arquitetura atual do projeto!** âœ…
